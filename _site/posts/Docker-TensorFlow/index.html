<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="baidu-site-verification" content="x4U8lzh1X1" /><title>Docker + TensorFlow 入门 - 游戏暂停</title><link href="https://fonts.googleapis.com/css?family=Lato:900|Work+Sans" rel="stylesheet"><link rel="stylesheet" href="/css/main.css"><title>Docker + TensorFlow 入门 | 游戏暂停</title><meta name="generator" content="Jekyll v3.7.3" /><meta property="og:title" content="Docker + TensorFlow 入门" /><meta property="og:locale" content="en_US" /><meta name="description" content="李家伟的博客。" /><meta property="og:description" content="李家伟的博客。" /><link rel="canonical" href="http://localhost:4000/posts/Docker-TensorFlow/" /><meta property="og:url" content="http://localhost:4000/posts/Docker-TensorFlow/" /><meta property="og:site_name" content="游戏暂停" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2017-03-05T15:32:00+00:00" /><script type="application/ld+json"> {"headline":"Docker + TensorFlow 入门","dateModified":"2017-03-05T15:32:00+00:00","datePublished":"2017-03-05T15:32:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/Docker-TensorFlow/"},"description":"李家伟的博客。","@type":"BlogPosting","url":"http://localhost:4000/posts/Docker-TensorFlow/","@context":"http://schema.org"}</script><script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } }, tex2jax: { inlineMath: [ ['$','$'], displayMath: [ ['$$','$$'] ], processEscapes: true, } });</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></head><body style="background-color: rgb(255, 255, 255)"><script src="/js/theme.min.js"></script><header> <a href="/"><div class="home"></div></a></header><h1 class="post-headline">Docker + TensorFlow 入门</h1><div class="meta"><span> 2017 年 3 月 5 日 </span></div><ul id="markdown-toc"><li><a href="#镜像和容器" id="markdown-toc-镜像和容器">镜像和容器</a></li><li><a href="#上手" id="markdown-toc-上手">上手</a><ul><li><a href="#homebrew-安装-docker" id="markdown-toc-homebrew-安装-docker">Homebrew 安装 Docker</a></li><li><a href="#docker-加速器设置" id="markdown-toc-docker-加速器设置">Docker 加速器设置</a></li><li><a href="#tensorflow-镜像安装" id="markdown-toc-tensorflow-镜像安装">TensorFlow 镜像安装</a></li><li><a href="#docker-关键命令" id="markdown-toc-docker-关键命令">Docker 关键命令</a></li></ul></li><li><a href="#让容器与本机的文件夹同步" id="markdown-toc-让容器与本机的文件夹同步">让容器与本机的文件夹同步</a><ul><li><a href="#jupyter-notebook-主题更改" id="markdown-toc-jupyter-notebook-主题更改">Jupyter Notebook 主题更改</a></li></ul></li></ul><p>Docker 是个非常轻量级的虚拟机，可以保证环境不影响代码的运行。</p><p>TensorFlow 官方在 Docker 上有镜像，可以直接下载。这几天研究了一点 Docker，感觉只看懂了一小角，也不知道对不对，就斗胆先写一些了。</p><h2 id="镜像和容器">镜像和容器</h2><p>Docker Hub 上可以得到各种来源的镜像，这个镜像就像以前装系统的光盘或者 .iso，装载了这个系统最初始的状态。</p><p>Docker 可以帮助我们把这个镜像安装，变成我们可以使用的容器，在这个容器里随便折腾，折腾完了可以删掉，再从镜像新建一个新容器，这样可以保证以前的折腾不会影响现在的代码，队友的环境也可以和自己保持一致。</p><h2 id="上手">上手</h2><p>本文以 Mac 为例，介绍如何上手 Docker。</p><h3 id="homebrew-安装-docker">Homebrew 安装 Docker</h3><p>如果有 homebrew，直接运行代码 <code class="highlighter-rouge">brew cask install docker</code> 即可安装 Docker，启动 Docker 后，Menu Bar 上会出现一只鲸鱼，也不是很明白鲸鱼和虚拟机有什么关系。</p><h3 id="docker-加速器设置">Docker 加速器设置</h3><p>因为国内的垃圾网络，最好装加速器来减少下载镜像的等待时间，我用了号称永久免费的 <a href="https://www.daocloud.io/">DaoCloud</a>，在得到镜像地址后，在 Docker 中如图所示设置。</p><p><img src="http://lijiawei.cc/images/屏幕快照 2017-03-05 下午2.57.26.png" alt="" /></p><h3 id="tensorflow-镜像安装">TensorFlow 镜像安装</h3><p>启动 Docker，然后终端运行以下命令，即可从 Docker Hub 上下载 TensorFlow 镜像。</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -it -p 8888:8888 tensorflow/tensorflow
</code></pre></div></div><p>如果你想要和你的容器共享文件，那么最好用这个命令：</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -it -p 8888:8888 -v ~/pathe/to/folder/you/wannna/share:/portal tensorflow/tensorflow
</code></pre></div></div><p>从你的容器访问 <code class="highlighter-rouge">/portal</code> 文件夹，就是你电脑上的 <code class="highlighter-rouge">~/pathe/to/folder/you/wannna/share</code> 文件夹。<code class="highlighter-rouge">/portal</code> 这个名字可以随便改，不过我觉得叫 <code class="highlighter-rouge">/portal</code> 还蛮酷的。</p><p>如果一切顺利的话，你就可以打开终端的链接，从浏览器访问 Jupyter Notebook 了。</p><h3 id="docker-关键命令">Docker 关键命令</h3><p>使用 <code class="highlighter-rouge">docker images</code> 查看装了哪些镜像：</p><p><img src="http://lijiawei.cc/images/屏幕快照 2017-03-05 下午3.05.15.png" alt="" /></p><p>使用 <code class="highlighter-rouge">docker rmi &lt;image name or tag or ID whatever&gt;</code> 可以删除镜像。</p><p>使用 <code class="highlighter-rouge">docker ps</code> 查看正在运行的容器（图中没有正在运行的容器）：</p><p><img src="http://lijiawei.cc/images/屏幕快照 2017-03-05 下午3.07.15.png" alt="" /></p><p>使用 <code class="highlighter-rouge">docker ps -a</code> 查看所有的容器：</p><p><img src="http://lijiawei.cc/images/屏幕快照 2017-03-05 下午3.08.37.png" alt="" /></p><p>使用 <code class="highlighter-rouge">docker rm &lt;container name or tag or ID whatever&gt;</code> 可以删除容器。</p><p>如果觉得一个一个删太烦，运行 <code class="highlighter-rouge">docker rm $(docker ps -a -q)</code>删除所有容器。</p><p>若要停止容器（比如端口被占），运行 <code class="highlighter-rouge">docker stop &lt;container name or tag or ID whatever&gt;</code>。启动容器运行 <code class="highlighter-rouge">docker start &lt;container name or tag or ID whatever&gt;</code>。</p><p>好的，现在到关键部分了！当我创建了一个 TensorFlow 容器后，我该怎么开始运行 Jupyter Notebook 呢？运行<code class="highlighter-rouge">docker start -i &lt;container name or tag or ID whatever&gt;</code> 就可以了！</p><p>在 notebook 里测试一下 <code class="highlighter-rouge">/portal</code> 是否正常，可以运行：</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>!ls /portal/
</code></pre></div></div><p>如果你和一样用的是 oh-my-zsh，你可以在 zshconfig 里加上这两个 alias 方便以后使用：</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 新建容器并从 /portal 传输文件
alias tfdocker="docker run -it -p 8888:8888 -v ~/Coding/DeepLearning101:/portal tensorflow/tensorflow"

# 启动 ID 为 a4032edb39cb 的容器并开启 Jupyter Notebook
alias startdocker="docker start -i a4032edb39cb"
</code></pre></div></div><h1 id="让容器与本机的文件夹同步">让容器与本机的文件夹同步</h1><p>参考<a href="https://github.com/junjielizero/DeepLearning101/blob/master/ch0/note/README.md">junjielizero 的笔记</a>，运行下列命令，可以创建于本机文件夹同步的笔记。</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -it -p 8888:8888 -v ~/Coding/DeepLearning101:/Coding/DeepLearning101 -w /Coding/DeepLearning101 tensorflow/tensorflow
</code></pre></div></div><h2 id="jupyter-notebook-主题更改">Jupyter Notebook 主题更改</h2><p>用了新编辑器怎么可以不换主题，在 Jupyter Notebook 中，以感叹号开头运行命令就是终端指令。在 notebook 中运行：</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>!pip install --upgrade jupyterthemes
</code></pre></div></div><p>如果一切顺利（在中国的垃圾网络下怎么可能顺利，你可能要多试几次），你就可以参考<a href="https://github.com/dunovank/jupyter-themes">GitHub - dunovank/jupyter-themes 文档</a> 做主题调整了。我输入的命令是：</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 用 solarized-light 主题，代码字体是 inputmono，字号 12 点，界面字体 sourcesans，输出字体 sourcesans，开启工具栏，开启标题栏
!jt -t solarized-light -f inputmono -fs 12 -nf sourcesans -tf sourcesans -T -N
</code></pre></div></div><p>结果如图：</p><p><img src="https://ww4.sinaimg.cn/large/006tKfTcgy1fdc04dobmyj30se0oyaec.jpg" alt="" /></p><br /><br /><div id="disqus_thread"></div><script> var disqus_config = function () { this.page.url = http://localhost:4000/posts/Docker-TensorFlow/; this.page.identifier = http://localhost:4000/posts/Docker-TensorFlow/; }; (function() { // DON'T EDIT BELOW THIS LINE var d = document, s = d.createElement('script'); s.src = 'https://you-xi-zan-ting.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><footer><div class="links"> <a href="/about/">About</a> <a href="/contact/">Contact</a> <a href="https://github.com/iewaij">Github</a> <a href="https://twitter.com/tiewuz">Twitter</a> <a href="/feed.xml">RSS</a></div></footer><script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-92264874-1', 'auto'); ga('send', 'pageview');</script></body></html>
