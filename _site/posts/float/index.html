<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="baidu-site-verification" content="x4U8lzh1X1" /><title>十进制与二进制：为什么浮点数不准？ - 游戏暂停</title><link href="https://fonts.googleapis.com/css?family=Lato:900|Work+Sans" rel="stylesheet"><link rel="stylesheet" href="/css/main.css"><title>十进制与二进制：为什么浮点数不准？ | 游戏暂停</title><meta name="generator" content="Jekyll v3.7.3" /><meta property="og:title" content="十进制与二进制：为什么浮点数不准？" /><meta property="og:locale" content="en_US" /><meta name="description" content="写代码的时候经常会发现计算机应该返回0.3，返回的却是0.30000011241，这是因为二进制转换为十进制时可能会有偏差。" /><meta property="og:description" content="写代码的时候经常会发现计算机应该返回0.3，返回的却是0.30000011241，这是因为二进制转换为十进制时可能会有偏差。" /><link rel="canonical" href="http://localhost:4000/posts/float/" /><meta property="og:url" content="http://localhost:4000/posts/float/" /><meta property="og:site_name" content="游戏暂停" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2017-07-24T13:40:00+01:00" /><script type="application/ld+json"> {"headline":"十进制与二进制：为什么浮点数不准？","dateModified":"2017-07-24T13:40:00+01:00","datePublished":"2017-07-24T13:40:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/float/"},"description":"写代码的时候经常会发现计算机应该返回0.3，返回的却是0.30000011241，这是因为二进制转换为十进制时可能会有偏差。","@type":"BlogPosting","url":"http://localhost:4000/posts/float/","@context":"http://schema.org"}</script><script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } }, tex2jax: { inlineMath: [ ['$','$'], displayMath: [ ['$$','$$'] ], processEscapes: true, } });</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></head><body style="background-color: rgb(255, 255, 255)"><script src="/js/theme.min.js"></script><header> <a href="/"><div class="home"></div></a></header><h1 class="post-headline">十进制与二进制：为什么浮点数不准？</h1><div>2017-07-24</div><p>写代码的时候经常会发现计算机应该返回0.3，返回的却是0.30000011241，这是因为二进制转换为十进制时可能会有偏差。</p><p>计算机是用开关的开和闭来表示1和0，因此计算机只能「计算」二进制。关于这部分更详细的介绍，例如图灵机、逻辑电路等内容，可以看<a href="https://www.amazon.cn/Code-The-Hidden-Language-of-Computer-Hardware-and-Software-Petzold-Charles/dp/0735611319/ref=sr_1_5?ie=UTF8&amp;qid=1500874764&amp;sr=8-5&amp;keywords=%E7%BC%96%E7%A0%81+%E9%9A%90%E5%8C%BF%E5%9C%A8%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%BD%AF%E7%A1%AC%E4%BB%B6%E8%83%8C%E5%90%8E%E7%9A%84%E8%AF%AD%E8%A8%80">《编码:隐匿在计算机软硬件背后的语言》</a>一书，也可以看李戈老师精彩的公开课<a href="https://pan.baidu.com/share/link?uk=1846002289&amp;shareid=1862561932#list/path=%2F">《计算概论 A》</a>的前三节，<a href="https://cs50.harvard.edu/">CS50</a> 有更简短的介绍，本文的截图就来自 CS50。</p><p>与计算机不同，人类是用十进制思考的，十进制，顾名思义，每到十就进一位，我们从0数到9，然后十位进一位得1，各位变成0，也就是10。</p><p>这里我有个不太理解的地方，从直觉的角度，人有十根手指头，应当从「一根」数到「十根」，每一根手指都应当有标准的符号，为什么第十根就变成10了呢？汉字用「一二三四五六七八九十」反而更自然吧。这里我没有更深入的查证，可能是因为古埃及和古巴比伦很早就有了高级的数字表示法，有兴趣的可以一起讨论。</p><p>十进制下，145这样的数字，代表 1 × 100 + 4 × 10 + 5 × 1。二进制下，1011 代表 1 × 8 + 0 × 4 + 1 × 2 + 1 × 1。</p><p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fhux3pnyu4j31ao0k0jsu.jpg" alt="" /></p><p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fhux3oatd3j31ao0k0jtc.jpg" alt="" /></p><p>十进制如何转换成二进制呢？一种思路是想成搭积木，如何用1、2、4、8、16……这些2的幂指数组合成十进制的数。比如42这个数，这是个偶数，所以我不用1，我肯定要用上32，然后我再找到2和8就够了，4和16都不要，所以二进制是101010。另一种思路是用算法，42 ÷ 2 取余数 0 得 21，21 ÷ 2 取余数 1 得 10，10 ÷ 2 取余数 0 得 5，5 ÷ 2 取余数 1 得 2，2 ÷ 2 取余数 0 得 1，1 ÷ 2 取余数 1 得 0。把这些余数从后到前，101010 即为二进制转换的结果。</p><p>本质上，第一种方法和第二种方法是相同的，通过余数判断这个数有没有1，再判断有没有2、4、8…… 如果有余数，就代表取1，没有就代表取0。</p><p>如果这个数有小数部分，就有点棘手了，以 1.25 为例，我先要让这个数变成整数，先乘上 2^3，1.25 × 2^3 = 10。十进制的10转换成二进制是1010，因为我之前已经让这个数乘上 2^3 次方了，所以我要除掉 2^3，在十进制里，我们除1000就是退三位，比如2274 ÷ 1000 = 2.274，在二进制里，除 2^3 就是退三位，1010 退三位是 1.010 也就是 1.01。</p><p>在转换的时候，我们会要求计算机把这个小数不断地 × 2，直到变成整数，但有些数字，比如 0.225，不论你乘上多少2的倍数，都没法变成整数，于是计算机只能近似地用二进制表示这些数，计算完毕后再转换成十进制出现在你的屏幕上，这个转换必然是有误差的，这就是出现 0.30000011241 这样的浮点数的原因。</p><p>所以在写代码的时候，a 和 b 分别是两个浮点数，不要出现 <code class="highlighter-rouge">if a == b</code>这样的判断，因为 a 和 b 经过计算后会有偏差，应该写成 <code class="highlighter-rouge">if a - b &lt;= 0.00001</code>。</p><div id="disqus_thread"></div><script defer> (function() { var d = document, s = d.createElement('script'); s.src = '//you-xi-zan-ting.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-92264874-1', 'auto'); ga('send', 'pageview');</script></body></html>
